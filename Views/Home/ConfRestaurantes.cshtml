@{
    ViewData["Title"] = "Menú del Restaurante";
}

<section class="comidas-container">
    <div class="container">
        <div class="info-restaurante-elegido">
            <h2>@ViewBag.Restaurante.Nombre</h2>
            
            <button id="btnAgregarComida" class="btn btn-primary mb-3">
                <i class="fas fa-plus"></i> Agregar Comida
            </button>

            <div id="modalAgregarComida" class="modal" style="display:none;">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3>Agregar Nueva Comida</h3>
                    <form id="formNuevaComida" method="post" enctype="multipart/form-data" 
                          action='@Url.Action("AgregarComida", "Home")'>
                        <input type="hidden" name="IdRestaurante" value="@ViewBag.Restaurante.IdRestaurante">
                        
                        <div class="form-group">
                            <label>Nombre:</label>
                            <input type="text" name="Nombre" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Descripción:</label>
                            <textarea name="Descripcion" class="form-control" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Precio:</label>
                            <input type="number" name="Precio" class="form-control" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Categoría:</label>
                            <select name="IdCategoriaComida" class="form-control" required>
                                @foreach (var categoria in ViewBag.Categorias)
                                {
                                    <option value="@categoria.IdCategoriaComida">@categoria.Nombre</option>
                                }
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Restricción alimenticia:</label>
                            <select name="IdRestriccionAlimenticia" class="form-control" required>
                                @foreach (var restriccion in ViewBag.Restricciones)
                                {
                                    <option value="@restriccion.IdRestriccionAlimenticia">@restriccion.TipoRestriccion</option>
                                }
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Imagen:</label>
                            <input type="file" name="Imagen" class="form-control" accept="image/*">
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                    </form>
                </div>
            </div>

            <div class="contenedor-comidas-card">
                @foreach (Comida alimento in ViewBag.Comida)
                {
                    <div class="comidas-card" id="card-@alimento.IdComida">
                        <form method="post" action='@Url.Action("ActualizarComida", "Home")' enctype="multipart/form-data" class="comida-form">
                            <input type="hidden" name="IdComida" value="@alimento.IdComida">
                            <input type="hidden" name="IdRestaurante" value="@alimento.IdRestaurante">
                            
                            <h5>@alimento.Nombre</h5>
                            
                            <div class="image-container">
                                <img id="imagen-@alimento.IdComida" src='@Url.Content("~/Images/" + alimento.Imagen)' alt="@alimento.Nombre" class="img-comida">
                            </div>
                            
                            <div class="card-actions">
                                <div class="precio-container">
                                    <label>Precio:</label>
                                    <input type="number" step="1" name="Precio" value="@alimento.Precio" class="form-control precio-input">
                                </div>
                                
                                <div class="action-buttons">
                                    <button type="submit" class="btn btn-success btn-guardar">
                                        <i class="fas fa-save"></i> Guardar
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                }
            </div>
        </div>
    </div>
</section>

@section Scripts {
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script>
    $(document).ready(function() {
        // Abrir modal
        $("#btnAgregarComida").click(function() {
            $("#modalAgregarComida").show();
        });

        // Cerrar modal
        $(".close").click(function() {
            $("#modalAgregarComida").hide();
        });

        // Cambiar imagen (para las cards existentes)
        $('.cambiar-imagen').click(function() {
            var id = $(this).data('id');
            $('.imagen-input[data-id="' + id + '"]').click();
        });
        
        // Preview de imagen al seleccionar archivo
        $('.imagen-input').change(function(e) {
            var id = $(this).data('id');
            var input = this;
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    $('#imagen-' + id).attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        });
        
        // Validación de formulario para actualizar comidas
        $('.comida-form').submit(function(e) {
            var precio = $(this).find('.precio-input').val();
            if (precio <= 0) {
                alert('El precio debe ser mayor que cero');
                return false;
            }
            return true;
        });

        // Validación del formulario para nueva comida
        $("#formNuevaComida").submit(function(e) {
            var precio = $("input[name='Precio']").val();
            if (precio <= 0) {
                alert("El precio debe ser mayor que cero");
                return false;
            }
            return true;
        });
    });

</script>
}