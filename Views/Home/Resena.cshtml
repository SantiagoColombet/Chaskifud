<div class="contenedor-resenas">
    <h2 class="titulo-contenedor">Reseñas de los usuarios</h2>
    @foreach (var resena in ViewBag.Resena)
    {
        <div class="tarjeta-resena">
            <div class="encabezado-resena">
                <div class="avatar-usuario"></div>
                <div class="detalles-resena">
                    <h3 class="autor-resena">@resena.Nombre</h3>
                    <p class="aporte-resena"> aporte(s)</p>
                </div>
            </div>
            <div class="contenido-resena">
                <h4 class="titulo-resena">Valoración: @resena.Valoracion</h4>
                <p class="fecha-resena">@resena.FechaEscrita</p>
                <p class="texto-resena">@resena.Opinion</p>
            </div>
            <div class="pie-resena">
                <div class="contenido-fecha-resena">
                    <p class="escrito-resena">Escrita el @resena.FechaEscrita</p>
                </div>
                <div class="votar-resena">
                    <ul>
                        <li>
                        <button type="button" class="boton-resena icon thumbs-up" 
                          onclick="enviarVoto('/Home/VotarArriba', @resena.IdResena, @resena.IdRestaurante, 'votos-arriba-@resena.IdResena')">
                        <p id="votos-arriba-@resena.IdResena">@resena.CantidadVotosArriba</p>
                        </button>
                        </li>

                        <li>
                        <button type="button" class="boton-resena icon thumbs-down" 
                        onclick="enviarVoto('/Home/VotarAbajo', @resena.IdResena, @resena.IdRestaurante, 'votos-abajo-@resena.IdResena')">
                        <p id="votos-abajo-@resena.IdResena">@resena.CantidadVotosAbajo</p>
                    </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    }
    <div class="nuevo-resena-contenedor">
        <h2 class="nuevo-resena-titulo">Escribe tu Reseña</h2>
        <form action="@Url.Action("CrearResena","Home")" method="post" class="nuevo-resena-formulario">
            <div class="nuevo-resena-campo">
                <label for="Nombre" class="nuevo-resena-label">Nombre:</label>
                <input type="text" id="Nombre" name="Nombre" class="nuevo-resena-input" required />
            </div>

            <div class="nuevo-resena-campo">
                <label for="Valoracion" class="nuevo-resena-label">Valoración:</label>
                <select id="Valoracion" name="Valoracion" class="nuevo-resena-select" required>
                    <option value="">Seleccione una valoración</option>
                    <option value="1">1 - Muy Malo</option>
                    <option value="2">2 - Malo</option>
                    <option value="3">3 - Regular</option>
                    <option value="4">4 - Bueno</option>
                    <option value="5">5 - Excelente</option>
                </select>
            </div>

            <div class="nuevo-resena-campo">
                <label for="Opinion" class="nuevo-resena-label">Opinión:</label>
                <textarea id="Opinion" name="Opinion" class="nuevo-resena-textarea" rows="4" required></textarea>
            </div>

            <div class="nuevo-resena-campo">
                <input type="hidden" name="IdRestaurante" value="@ViewBag.Resena[0].IdRestaurante" />
                <input type="hidden" name="IdUsuario" value="1" />
                <button type="submit" class="nuevo-resena-boton">Enviar Reseña</button>
            </div>
        </form>
    </div>
</div>


<script>
function enviarVoto(url, idResena, idRestaurante, elementoId) {
    const dataToSend = { IdResena: idResena, IdRestaurante: idRestaurante };
    console.log("Datos enviados al servidor:", JSON.stringify(dataToSend));

    $.ajax({
        url: url,
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(dataToSend),
        dataType: 'json',
        success: function(data) {
            console.log('Respuesta del servidor:', data);
            const votoElemento = document.getElementById(elementoId);
            if (votoElemento) {
                votoElemento.textContent = data.nuevaCantidadVotos;
            } else {
                console.error('No se encontró el elemento con el id', elementoId);
            }
        },
        error: function(xhr, status, error) {
            console.error('Error en la solicitud AJAX:', error);
        }
    });
}


</script>