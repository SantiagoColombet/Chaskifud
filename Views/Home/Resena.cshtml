<div class="contenedor-resenas">
    <h2 class="titulo-contenedor">Reseñas de los usuarios</h2>
    
    <input type="text" class="campo-busqueda" placeholder="Buscar reseñas...">
    
    <div class="contenedor-botones">
        <button class="btn-filtro">Filtros</button>
        <button class="btn-filtro">Las más recientes ▼</button>
    </div>

    @foreach (var resena in ViewBag.Resena)
    {
        <div class="tarjeta-resena">
            <div class="encabezado-resena">
                <div class="avatar-usuario"></div>
                <div class="detalles-resena">
                    <h3 class="autor-resena">@resena.Nombre</h3>
                    <p class="aporte-resena"> aporte(s)</p>
                </div>
            </div>
            <div class="contenido-resena">
                <h4 class="titulo-resena">Valoración: @resena.Valoracion</h4>
                <p class="fecha-resena">@resena.FechaEscrita</p>
                <p class="texto-resena">@resena.Opinion</p>
            </div>
            <div class="pie-resena">
                <div class="contenido-fecha-resena">
                    <p class="escrito-resena">Escrita el @resena.FechaEscrita</p>
                </div>
                <div class="votar-resena">
                    <ul>
                        <li>
                        <button type="button" class="boton-resena icon thumbs-up" 
                          onclick="enviarVoto('/Home/VotarArriba', @resena.IdResena, @resena.IdRestaurante, 'votos-arriba-@resena.IdResena')">
                        <p id="votos-arriba-@resena.IdResena">@resena.CantidadVotosArriba</p>
                        </button>
                        </li>

                        <li>
                        <button type="button" class="boton-resena icon thumbs-down" 
                        onclick="enviarVoto('/Home/VotarAbajo', @resena.IdResena, @resena.IdRestaurante, 'votos-abajo-@resena.IdResena')">
                        <p id="votos-abajo-@resena.IdResena">@resena.CantidadVotosAbajo</p>
                    </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    }
</div>

<script>
function enviarVoto(url, idResena, idRestaurante, elementoId) {
    const dataToSend = { IdResena: idResena, IdRestaurante: idRestaurante };
    console.log("Datos enviados al servidor:", JSON.stringify(dataToSend));

    $.ajax({
        url: url,
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(dataToSend),
        dataType: 'json',
        success: function(data) {
            console.log('Respuesta del servidor:', data);
            const votoElemento = document.getElementById(elementoId);
            if (votoElemento) {
                votoElemento.textContent = data.nuevaCantidadVotos;
            } else {
                console.error('No se encontró el elemento con el id', elementoId);
            }
        },
        error: function(xhr, status, error) {
            console.error('Error en la solicitud AJAX:', error);
        }
    });
}


</script>